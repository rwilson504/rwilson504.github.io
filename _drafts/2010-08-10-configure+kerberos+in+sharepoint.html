---
layout: post
title: Configure Kerberos in SharePoint
date: '2010-08-10T16:25:00.001-04:00'
author: Rick Wilson
tags: 
modified_time: '2010-08-10T17:41:22.611-04:00'
thumbnail: http://3.bp.blogspot.com/_mr9BzRLR2GQ/TGHD_aKOtEI/AAAAAAAAFDE/PW0erhLsdKM/s72-c/SQLServerDelegation.jpg
blogger_id: tag:blogger.com,1999:blog-8675696861245191896.post-9185136233887829951
---

<b>Domain</b>: mydomain.local<br /><b>SharePoint Url</b>: home.mydomain.local<br /><strong>SharePoint MySite Url</strong>: mysite.mydomain.local<br /><b>SharePoint Site Application Pool User</b>: mydomain\spapppool<br /><strong>SharePoint Server Name</strong>: SPServer.mydomain.local<br /><strong>SharePoint Server NetBIOS Name</strong>: SPServer<br /><b>SQL Server Name</b>: SQLServer1.mydomain.local<br /><b>SQL Server NetBIOS Name</b>: SQLServer1<br /><br /><div>&nbsp;</div><strong><span style="font-size: large;">Setting Service Principal Names</span></strong><br />The following commands assume you are using the Server 2008 SetSPN utility. If you are using the 2003 version replace “–F –S” with “-A”<br /><br /><div>&nbsp;</div>The following command sets the SPN for your SQL services. You will notice that we are running two commands here one for the NetBIOS name of the SQL server and another for the full distinguished name of the SQL server.<br /><br /><div>&nbsp;</div><pre style="background-color: #eeeeee; border-bottom: #999999 1px dashed; border-left: #999999 1px dashed; border-right: #999999 1px dashed; border-top: #999999 1px dashed; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px; width: 100%;">```Setspn -F -S MSSQLSvc/SQLServer1:1433<br /><br />Setspn -F -S MSSQLSvc/SQLServer1.mydomain.local:1433<br />```</pre><br /><div>&nbsp;</div>The command below the SPN for our SharePoint site home.portal.local. A few things to remember here: <br /><ul><li>Do not type in the URL for the site http://home.portal.local, the command below is setting the SPN on the http server running home.portal.local. </li><li>The http service runs both the http and https sites you do not need to register another spn for https/home.portal.loca if you are using https, doing so would create duplicate SPNs which causes errors.</li><li>This is assuming a domain account is being used for the application pool.&nbsp; If you were using the NetworkServices account for the app pool then you would register any SPNs on the machine and not an account.</li><li>A tool for creating SPNs can be found here: http://httpcode.com/tools/spntool.aspx</li></ul><pre style="background-color: #eeeeee; border-bottom: #999999 1px dashed; border-left: #999999 1px dashed; border-right: #999999 1px dashed; border-top: #999999 1px dashed; color: black; font-family: Andale Mono, Lucida Console, Monaco, fixed, monospace; font-size: 12px; line-height: 14px; overflow: auto; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; padding-top: 5px; width: 100%;">```Setspn –F -S http/home.mydomain.local mydomain/spapppool<br />```</pre><br /><strong><span style="font-size: large;">Trust SQL Server and Application Pool User for Delegation</span></strong><br />Now that the SPNs are set on the SQL server and application pool account we need to allow Kerberos delegation within Active Directory.&nbsp; <span style="color: red;">Note: If you have not set the SPNs for the machine and account you will not see the Delegation tab.</span><br /><br />Open the 'Active Directory Users and Computers' snap-in<br /><br />Navigate to the SQLServer1 record, right click, and select 'Properties'<br /><br />Click on the Delegation tab and select 'Trust this computer for delegation to any service (Kerberos only)<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/_mr9BzRLR2GQ/TGHD_aKOtEI/AAAAAAAAFDE/PW0erhLsdKM/s1600/SQLServerDelegation.jpg" imageanchor="1" style="clear: left; cssfloat: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="320" mx="true" src="http://3.bp.blogspot.com/_mr9BzRLR2GQ/TGHD_aKOtEI/AAAAAAAAFDE/PW0erhLsdKM/s320/SQLServerDelegation.jpg" width="261" /></a></div><div class="separator" style="clear: both; text-align: left;">Navigate to the spapppool user record, right click, and select 'Properties'</div><div style="text-align: left;"></div><div style="text-align: left;"></div><div>&nbsp;</div><div style="text-align: left;">Click on the Delegation tab and select 'Trust this computer for delegation to any service (Kerberos only)</div><div style="text-align: left;"><br /></div><div style="text-align: left;"><a href="http://1.bp.blogspot.com/_mr9BzRLR2GQ/TGHEH2uCkhI/AAAAAAAAFDM/-_sGT7VSfzY/s1600/AppPoolDelegation.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" mx="true" src="http://1.bp.blogspot.com/_mr9BzRLR2GQ/TGHEH2uCkhI/AAAAAAAAFDM/-_sGT7VSfzY/s320/AppPoolDelegation.jpg" /></a></div><br /><div>&nbsp;</div><div><strong><span style="font-size: large;">Windows 2008 Web Application Updates</span></strong></div>If you are utilzing Windows Server 2008 to host SharePoint you will also need to complete the following.<br /><br />-<br /><br /><strong><span style="font-size: large;">Update SharePoint Authentication</span></strong><br /><br />SharePoint 2007<br /><br />Open the Central Administration site and navigate to Central Administration &gt; Application Management &gt; Authentication Providers <br /><br />SharePoint 2010